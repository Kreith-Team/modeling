<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <style>
      #cy {
        width: 100%;
        height: 400px;
      }
    </style>
    <base target="_top">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/cytoscape/3.18.0/cytoscape.min.js" integrity="sha512-bg1QBgIk64XNmh8qAaxY2W6TKZ4/Q2sbPQLJ+1vhT3BD+DXXzAqhIbWdgeM82XWcbJKblEoSNhXiakf1NlWU3g==" crossorigin="anonymous"></script>
  </head>
  <body>
    <? if (!web) { // check if in sidebar mode ?>
      <?!= "<a href = \"" + buildUrl(ssid) + "\" target=\"_blank\">Open window</a>" ?>
    <? } ?>
    <p>Active User: <?= activeUser ?></p>
    <p>Effective User: <?= effectiveUser ?></p>
    <?= extractData(); ?>
    <h1>Modeling App Loaded</h1>
    <div id=""></div>
    <?
      Logger.log(ssid);
      let spreadsheet = SpreadsheetApp.openById(ssid);
      let sheet = spreadsheet.getSheets()[0];
      let relations = findRecurrence(sheet);
      for (let i = 0; i < relations.length; i++) {
      ?>
        <div><?!= "<a onmouseover=\"google.script.run.withSuccessHandler( () => { console.log('Success'); } ).withFailureHandler( () => { console.log('Failure.') }).highlight('" + ssid + "', '" + relations[i].range.getA1Notation() + "')\""
        + "onmouseout=\"google.script.run.withSuccessHandler( () => { console.log('Success'); } ).withFailureHandler( () => { console.log('Failure.') }).unhighlight('" + ssid + "', '" + relations[i].range.getA1Notation() + "')\""
        + ">" 
        ?> 
        <?= relations[i].formula ?> <?!= "</a>" ?> <?= relations[i].range.getA1Notation() ?></div>
      <?
      }
    ?>
    <div id="cy"></div>
    
    
    <button
      onclick="google.script.run.withSuccessHandler( () => { console.log('Success'); } ).withFailureHandler( () => { console.log('Failure.') }).test()" >
      Test
    </button>
    
    
    <?!= include('Graph.js'); ?>
  </body>
</html>

